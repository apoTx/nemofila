extends layout

append stylesheets
    link(rel='stylesheet', type='text/css', href='/semantic/dist/components/button.min.css')
    link(rel='stylesheet', type='text/css', href='/semantic/dist/components/popup.min.css')
    link(rel='stylesheet', type='text/css', href='/semantic/dist/components/breadcrumb.min.css')
    link(rel='stylesheet', type='text/css', href='/semantic/dist/components/table.min.css')
    link(rel='stylesheet', type='text/css', href='/semantic/dist/components/card.min.css')
    link(rel='old stylesheet', href='/ng-image-gallery/dist/ng-image-gallery.min.css')
    link(rel='stylesheet', type='text/css', href='/dist/css/style.css')
    link(rel='stylesheet', type='text/css', href='/dist/css/detail.css')

block content
    - var sessionId;
    - if (session)
        - sessionId = session._id;
    - else
        - sessionId = null;

    - var photosList = JSON.stringify(data.photos);

    div.detailContainer(ng-controller="detailController" ng-init="init('#{sessionId}','#{ data._id }', '#{JSON.stringify(data.photos)}', '#{ amazon_base_url }' )")

        - if (data.status === 0)
            .ui.warning.message.margin-bottom-30
                .header
                    | This ad is in the approval phase
                |   Only you can view it.

        - if (data.status === 2)
            .ui.negative.message.margin-bottom-30
                .header
                    | This ad has been rejected.
                |   Only you can view it.

        - if (data.status === 3)
            .ui.negative.message.margin-bottom-30
                .header
                    | This ad expired.
                |   Only you can view it.

        - if (data.status === 4)
            .ui.negative.message.margin-bottom-30
                .header
                    | This ad has been unpublished.
                |   Only you can view it.

        .ui.stackable.grid
            .ten.wide.column
                h1 #{data.title}

            .six.wide.column.text-right.detail-right-menu
                .ui.right.floated.main.menu
                    a.music.popup.icon.item(
                            data-content='Share with Facebook',
                            target="_blank",
                            onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=300,width=600');return false;",
                            href="https://www.facebook.com/sharer/sharer.php?u=#{url}"
                        )
                        i.facebook.icon
                    a.music.popup.icon.item(data-content='Share with Twitter')
                        i.twitter.icon
                    a.music.popup.icon.item(data-content='Share with Google+')
                        i.google.plus.icon


                - if (session)
                    .ui.right.floated.main.menu(
                        ng-show="!isFav",
                        ng-cloak
                    )
                        a.music.popup.icon.item(
                            data-content='Add Favorites',
                            ng-click="addFavourites('#{ session._id }','#{ data._id }')"
                        )
                            i.star.empty.icon

                    .ui.right.floated.main.menu(
                        ng-show="isFav",
                        ng-cloak
                    )
                        a.music.popup.icon.item(
                        data-content='Remove Favorites',
                        ng-click="delFavourites('#{ session._id }','#{ data._id }')"
                        )
                            i.star.icon

        .ui.stackable.grid
            .six.wide.column
                a.ui.fluid.image.showcaseImage(
                        ng-click='openGallery()',
                        href="javascript:;"
                    )
                    - if (data.photos !== null)
                        img(
                            ng-init="showcase(#{ JSON.stringify(data.photos) }, #{ data.photoShowcaseIndex })",
                            ng-src='#{ amazon_base_url }/{{ showcase }}'
                        )
                    - else
                        img(ng-src='/img/no-photo.png')

                .ui.images.detail-photo-list.text-center
                    - if (data.photos !== null)
                        ng-image-gallery(
                            images='imagesa',
                            methods='methods',
                            img-anim='slide',
                            conf='conf',
                            on-open='opened();',
                            on-close='closed();',
                            on-delete='delete(img, cb)',
                            bubble-size=18,
                            img-bubbles="true",
                        )

                        each photo,k in data.photos
                            img.ui.image.mini(
                                ng-click='changePhoto(#{k})',
                                src='#{ amazon_base_url }/#{ photo.filename }'
                            )

            .ten.wide.column
                h2 $#{ data.price }

                .ui.breadcrumb.tiny
                    .active.section #{ location.name }
                    .divider  /
                    .active.section #{ location.cityName }
                    .divider  /
                    .active.section #{ location.districtName }


                table.ui.definition.table
                    tbody
                        tr
                            td Category
                            td #{ category.name } / #{ category.childCategoryName }
                        tr
                            td Listing Date
                            td #{ moment(data.listingDate).format("DD/MM/YYYY") }
                        tr
                            td Contact Name
                            td
                                - if (!data.anotherContact || !data.anotherContact.checked)
                                    div.contact-name #{ data.user.name } #{ data.user.surname }

                                    - if (sessionId !== null && (sessionId != String(data.user._id)))
                                        button.ui.right.floated.button.primary(ng-click="openSendMessageModal()") Send Message
                                - else
                                    | test
                                    div #{ data.anotherContact.name }
                                .clearfix
                        tr
                            td Contact Number
                            td
                                a.phone-number(href="tel:#{ data.user.phone }")
                                    - if (!data.anotherContact || !data.anotherContact.checked)
                                        | #{ data.user.phone }
                                    - else
                                        div #{ data.anotherContact.phone }


        h3 Description
        .ui.segment
            p.description
                | !{ data.description }

        - if (sessionId !== null && (sessionId != String(data.user._id)))
            // Send Message Modal
            .ui.modal.tiny#sendMessageModal
                i.close.icon
                .header
                    | Send Message
                .content
                    div(ng-show="!messageSended" ng-cloak)
                        div.margin-bottom-30
                            h4.no-margin-bottom To: #{ data.user.name } #{ data.user.surname }

                        form.ui.form#sendMessageForm
                            input(type='hidden', ng-init="sendMessageFormData.toUserId = '#{ data.user._id }' ", ng-model="sendMessageFormData.toUserId")
                            input(type='hidden', ng-init="sendMessageFormData.adId = '#{ data._id }' ", ng-model="sendMessageFormData.adId")

                            .fields.ui.grid
                                .field.sixteen.wide.column.no-padding-top.no-padding-bottom
                                    textarea(
                                        name="message",
                                        placeholder='Enter your message',
                                        ng-model='sendMessageFormData.message'
                                    )
                            .ui.error.message
                            .backendErr.ui.red.message(ng-if="sendMessageErr")
                                | {{ sendMessageErr }}

                    div(ng-show="messageSended" ng-cloak)
                        .ui.success.message
                            .header
                                | Your message has been sent.
                .actions
                    button.ui.right.icon.button.primary(
                        form="sendMessageForm",
                        ng-class="sendMessageLoading ? 'loading disabled' : '' ",
                        ng-show="!messageSended"
                    )
                        | Submit

append javascripts
    script(src="/semantic/dist/components/popup.min.js")
    script(src="/dist/js/app/services/favFactory.min.js")
    script(src="/dist/js/app/controllers/detailController.min.js")
