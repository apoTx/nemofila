extends layout

append stylesheets
    link(rel='stylesheet', type='text/css', href='semantic/dist/components/card.min.css')
    link(rel='stylesheet', type='text/css', href='semantic/dist/components/input.min.css')
    link(rel='stylesheet', type='text/css', href='semantic/dist/components/checkbox.min.css')
    link(rel='stylesheet', type='text/css', href='semantic/dist/components/table.min.css')
    link(rel='stylesheet', type='text/css', href='semantic/dist/components/card.min.css')
    link(rel='stylesheet', type='text/css', href='semantic/dist/components/step.min.css')
    link(rel='stylesheet', type='text/css', href='semantic/dist/components/loader.min.css')
    link(rel='stylesheet', type='text/css', href='semantic/dist/components/message.min.css')
    link(rel='stylesheet', type='text/css', href='/dist/css/newAdPage.css')
    link(rel='stylesheet', type='text/css', href='/ngWig/dist/css/ng-wig.min.css')


block content
    div(ng-controller="newAdController")
        div(ng-if="!adSaveComplete", ng-cloak)

            .ui.steps.fluid(class="margin-bottom-30")
                a.step(ng-class="steps.informations ? 'active': 'disabled' " ng-cloak)
                    i.info.icon
                    .content
                        .title #{ i18n.__("newAd_tab_ad_information") }
                        .description #{ i18n.__("newAd_tab_ad_information_message")}

                a.step(ng-class="steps.power ? 'active': 'disabled' " ng-cloak)
                    i.rocket.icon
                    .content
                        .title #{ i18n.__("newAd_tab_buy_power") }
                        .description #{ i18n.__("newAd_tab_buy_power_message") }

                a.step.disabled(ng-class="steps.preview ? 'active':'disabled' " ng-cloak)
                    i.unhide.icon
                    .content
                        .title #{ i18n.__("newAd_tab_preview") }
                        .description #{ i18n.__("newAd_tab_preview_message") }

            .ui.segment.no-segment.test
                .ui.dimmer(ng-class="loadingBufferData ? 'active': ''")
                    .ui.text.loader Loading

                div#adInformation(ng-show="steps.informations", ng-cloak)
                    form.ui.form.fluid#newAdForm(ng-init="init('#{ id }')")
                        input(type='hidden', name='Content-Type', value='')
                        input(type='hidden', name='Content-Type', ng-init="url= '#{ formdata.url }' ", ng-model="url")
                        input(type='hidden', name='acl', ng-model="acl", ng-init="acl= '#{ formdata.inputs.acl }'")
                        input(type='hidden', name='success_action_status', ng-model="success_action_status", ng-init="success_action_status= '#{ formdata.inputs.success_action_status }'" )
                        input(type='hidden', name='policy', ng-model="policy", ng-init="policy = '#{ formdata.inputs.policy }'")
                        input(type='hidden', name='X-amz-credential', ng-model="x_amz_credential", ng-init="x_amz_credential= '#{ formdata.inputs['X-amz-credential'] }'")
                        input(type='hidden', name='X-amz-algorithm', ng-model="X_amz_algorithm", ng-init="X_amz_algorithm = '#{ formdata.inputs['X-amz-algorithm'] }'")
                        input(type='hidden', name='X-amz-date', ng-model="X_amz_date", ng-init="X_amz_date = '#{ formdata.inputs['X-amz-date'] }'")
                        input(type='hidden', name='X-amz-expires', ng-model="X_amz_expires", ng-init="X_amz_expires = '#{ formdata.inputs['X-amz-expires'] }'")
                        input(type='hidden', name='X-amz-signature', ng-model="X_amz_signature", ng-init="X_amz_signature = '#{ formdata.inputs['X-amz-signature'] }'")

                        .fields.two
                            .field.wide.twelve
                                label #{ i18n.__("title") }
                                input(name='title', placeholder='#{ i18n.__("title") }',  ng-model="newAdForm.title")
                            .field.wide.four
                                label #{ i18n.__("price") }
                                .ui.right.labeled.input
                                    input(type='text', name="price", placeholder='#{ i18n.__("price") }', ng-model="newAdForm.price")
                                    .ui.basic.label
                                        | USD
                        .field
                            label #{ i18n.__("description") }
                            ng-wig(
                                name='description',
                                ng-model='newAdForm.description'
                            )

                        .five.fields(country-and-category-dropdowns)

                        .ui.tiny.stacked.segment
                            .text-center
                                .ui.labeled.button(tabindex='0', ng-click='triggerUploadWindow()')
                                    .ui.button
                                        i.upload.icon
                                        |  #{ i18n.__("upload_photos") }
                                    a.ui.basic.label
                                        | {{ newAdForm.files.length > 0 ? newAdForm.files.length : '0'  }}
                                input(
                                    type='file',
                                    style="width:30%"
                                    ngf-select='onPhotoSelect()',
                                    ng-model='newAdForm.files',
                                    name='photos',
                                    class='hidden'
                                    ngf-pattern="'image/*'",
                                    ngf-accept="'image/*'",
                                    ngf-max-size='4MB',
                                    ngf-multiple='true',
                                    ngf-keep='true',
                                    ngf-keep-distinct='true',
                                    ngf-max-files="10",
                                    ngf-model-invalid="invalidFiles",
                                    ngf-resize="{ quality: .7 }"
                                )

                            .clearfix &nbsp;
                            .ui.warning.message.margin-bottom-30(ng-show="invalidFiles.length > 0",style="display:block")
                                .header
                                    | #{ i18n.__("photo_size_limit") }

                            .ui.four.stackable.cards
                                .card.photoList(ng-repeat='f in newAdForm.files')
                                    .image.photoListImage
                                        a.ui.left.corner.label(ng-if="f.showcase", ng-cloak)
                                            i.bookmark.icon
                                        img(
                                            ngf-thumbnail="f.filename ? '#{ amazon_base_url }/{{f.filename}}': f ",
                                            ngf-size="{width:200, height:200, quality:0.6}",
                                            ng-src="img/spinner.gif",
                                            class="upload-photo-thumb"
                                        )

                                        span.progress(ng-hide="f.progressFinish", ng-if="f.progress >= 0")
                                            div(style='width:{{f.progress}}%', ng-bind="f.progress + '%'")


                                    .ui.bottom.attached.button.noRadius(
                                        ng-click="onDeletePhoto($index)",
                                        ng-if="f.showcase",
                                        ng-cloak
                                    )
                                        i.remove.icon
                                        |  #{ i18n.__("remove") }


                                    .ui.two.buttons(ng-if="!f.showcase", ng-cloak)
                                        .ui.bottom.attached.button.noRadius(ng-click="onDeletePhoto($index)")
                                            i.remove.icon.margin-auto
                                        .ui.bottom.attached.button.noRadius(ng-click="onSelectShowCase($index)")
                                            i.bookmark.icon.margin-auto


                                | {{errorMsg}}

                        .field.ui.segment
                            .ui.grid
                                .sixteen.wide.column
                                    .ui.checked.checkbox
                                        input.hidden(type='checkbox', checked="", tabindex='0', name='anotherContactChecked', ng-model='newAdForm.anotherContact.checked')
                                        label #{ i18n.__("use_another_person") }
                                .sixteen.wide.column.no-padding-top#anotherContact(ng-if="newAdForm.anotherContact.checked",  ng-cloak)
                                    .fields.two
                                        .field.wide.eight
                                            input(name='anotherContactName', placeholder='#{ i18n.__("contact_name") }', ng-model='newAdForm.anotherContact.name')
                                        .field.wide.eight
                                            input(name='anotherContactPhone', placeholder='#{ i18n.__("contact_number") }', ng-model='newAdForm.anotherContact.phone')


                        .ui.error.message
                        .backendErr.ui.red.message(ng-if="newAdErr", ng-cloak)
                            | {{ newAdErr }}

                        button.ui.right.floated.primary.button(
                                form="newAdForm",
                                ng-class="uploading ? 'loading disabled' : '' "
                            )
                            | #{ i18n.__("next_btn") }

                        .clearfix


                div#powerTab(ng-show="steps.power", ng-cloak)
                    div.text-center
                        h1 Power Up!

                        div(ng-show="buyPowerStatus")
                            .ui.success.message
                                .header
                                    | #{ i18n.__("bought_power_message") }

                        .ui.segment.no-segment(ng-show="!buyPowerStatus")
                            p
                                | #{ i18n.__("power_up_text1") }
                                br
                                | #{ i18n.__("power_up_text2") }
                            form.ui.form
                                .field.text-center
                                    select.powerNumber(
                                        style="width:50%; display:inline-block",
                                        name='powernumber',
                                        ng-model="powerNumber",
                                        ng-change="update(id);",
                                        ng-options="n for n in []  | range:1:101"
                                    )
                                        option(value='0') #{ i18n.__("please_select") }

                                    div.margin-top-10(ng-show="powerNumber > 0")
                                        h3 {{ powerNumber * 10 | number:2 }} EUR

                                    .clearfix
                                    button.ui.primary.button.margin-top-10#buttonCheckout #{ i18n.__("buy_power") }

                            .ui.dimmer(ng-class="{ active: buyPowerLoader }")
                                .ui.loader


                    div.padding-30
                        button.ui.right.floated.primary.button(ng-click="previewTab()")
                            | #{ i18n.__("next_btn") }
                        button.ui.right.floated.secondary.button(ng-click="adInformationTab()")
                            | #{ i18n.__("back_btn") }



                div#preview(ng-show="steps.preview", ng-cloak)
                    h2 {{ newAdForm.title }}
                    h3 {{ newAdForm.price | currency }}

                    .ui.four.stackable.cards
                        .card.photoList(ng-repeat='f in newAdForm.files')
                            .image.photoListImage
                                a.ui.left.corner.label(ng-if="f.showcase", ng-cloak)
                                    i.bookmark.icon
                                img(
                                ngf-thumbnail="f.filename ? '#{ amazon_base_url }/{{f.filename}}': f ",
                                ngf-size="{width:200, height:200, quality:0.6}",
                                ng-src="img/spinner.gif",
                                class="upload-photo-thumb"
                                )

                                span.progress(ng-hide="f.progressFinish", ng-if="f.progress >= 0")
                                    div(style='width:{{f.progress}}%', ng-bind="f.progress + '%'")

                    .ui.stackable.grid
                        .sixteen.wide.column
                            table.ui.definition.table
                                tbody
                                    tr
                                        td #{ i18n.__("location") }
                                        td
                                            | {{ countries[newAdForm.country].name }} /
                                            | {{ countries[newAdForm.country].cities[newAdForm.city].name }} /
                                            | {{ countries[newAdForm.country].cities[newAdForm.city].districts[newAdForm.district].name }}
                                    tr
                                        td #{ i18n.__("category") }
                                        td {{ categories[newAdForm.category].name }} / {{ categories[newAdForm.category].subCategories[newAdForm.categoryChild].name }}
                                    tr
                                        td #{ i18n.__("contact_name") }
                                        td
                                            span(ng-show="newAdForm.anotherContact.checked")
                                                | {{ newAdForm.anotherContact.name }}
                                            span(ng-hide="newAdForm.anotherContact.checked")
                                                | #{ user.name } #{ user.surname }

                    h3 #{ i18n.__("description") }
                    .ui.segment
                        p.description(ng-bind-html="newAdForm.description")

                    button.ui.right.floated.primary.button(ng-click="uploadAndSaveMongo('#{ id }')", ng-class="{loading:submitBtnLoading, disabled:uploading}")
                        | #{ i18n.__("save_btn") }
                    button.ui.right.floated.secondary.button(ng-click="powerTab()", ng-class="{disabled:uploading}")
                        | #{ i18n.__("back_btn") }

        div(ng-if="adSaveComplete", ng-cloak)
            div.text-center
                h1 #{ i18n.__("new_ad_successful_title") }
                div.margin-bottom-30 #{ i18n.__("new_ad_successful_info") }
                a.ui.primary.button(href="./") #{ i18n.__("index_title") }



append javascripts
    script(src="/dist/js/app/services/categoriesFactory.min.js")
    script(src="/dist/js/app/services/countriesFactory.min.js")
    script(src="/dist/js/app/directives/countryAndCategoryDropdowns.min.js")
    script(src="https://checkout.stripe.com/checkout.js")
    script(src="/dist/js/app/stripe.min.js")
    script(src="/dist/js/app/filters/range.min.js")
    script(src="/js/app/controllers/newAdController.js")
    script(src="semantic/dist/components/checkbox.min.js")
