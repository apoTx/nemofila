extends layout

append stylesheets
    link(rel='stylesheet', type='text/css', href='semantic/dist/components/card.min.css')
    link(rel='stylesheet', type='text/css', href='semantic/dist/components/input.min.css')
    link(rel='stylesheet', type='text/css', href='semantic/dist/components/checkbox.min.css')
    link(rel='stylesheet', type='text/css', href='semantic/dist/components/card.min.css')
    link(rel='stylesheet', type='text/css', href='semantic/dist/components/step.min.css')
    link(rel='stylesheet', type='text/css', href='semantic/dist/components/loader.min.css')


block content
    div(ng-controller="newAdController")
        div(ng-if="!adSaveComplete", ng-cloak)
            .ui.steps.fluid(class="margin-bottom-30")
                a.step(ng-class="steps.informations ? 'active': 'disabled' " ng-cloak)
                    i.info.icon
                    .content
                        .title Ad Information
                        .description Please enter your ad informations.

                a.step.disabled(ng-class="steps.preview ? 'active':'disabled' " ng-cloak)
                    i.unhide.icon
                    .content
                        .title Preview
                        .description Your ad will look like this.

            .ui.segment.no-segment
                .ui.dimmer(ng-class="loadingBufferData ? 'active': ''")
                    .ui.text.loader Loading

                div#adInformation(ng-if="steps.informations", ng-cloak)
                    form.ui.form.fluid#newAdForm(ng-init="init('#{ redisId }')")
                        .fields.two
                            .field.wide.twelve
                                label Title
                                input(name='name', placeholder='Title',  ng-model="newAdForm.title")
                            .field.wide.four
                                label Price
                                .ui.right.labeled.input
                                    input(type='text', name="price", placeholder='Price', ng-model="newAdForm.price")
                                    .ui.basic.label
                                        | USD
                        .field
                            label Description
                            textarea(name='surname', ng-model='newAdForm.description')

                        .five.fields(country-and-category-dropdowns)

                        .ui.tiny.stacked.segment
                            .text-center
                                .ui.labeled.button(tabindex='0', ng-click='triggerUploadWindow()')
                                    .ui.button
                                        i.upload.icon
                                        |  Upload Photos
                                    a.ui.basic.label
                                        | {{ newAdForm.files.length > 0 ? newAdForm.files.length : '0'  }}
                                input(
                                    type='file',
                                    style="width:30%"
                                    ngf-select='onPhotoSelect()',
                                    ng-model='newAdForm.files',
                                    name='photos',
                                    class='hidden'
                                    ngf-pattern="'image/*'",
                                    ngf-accept="'image/*'",
                                    ngf-max-size='2MB',
                                    ngf-multiple='true',
                                    ngf-keep='true',
                                    ngf-keep-distinct='true',
                                    ngf-max-files="10"
                                )

                            .clearfix &nbsp;

                            .ui.four.cards
                                .card(ng-repeat='f in newAdForm.files')
                                    .image
                                        a.ui.left.corner.label(ng-if="f.showcase", ng-cloak)
                                            i.bookmark.icon
                                        img(
                                            ngf-thumbnail="f.filename ? 'uploads/#{redisId}/{{f.filename}}': f ",
                                            ngf-size="{width:200, height:200, quality:0.6}",
                                            ng-src="img/spinner.gif",
                                            class="upload-photo-thumb"
                                        )

                                    .ui.bottom.attached.button(ng-click="onDeletePhoto($index)", ng-if="f.showcase", ng-cloak)
                                        i.remove.icon
                                        |  Remove

                                    .ui.two.buttons(ng-if="!f.showcase", ng-cloak)
                                        .ui.bottom.attached.button(ng-click="onDeletePhoto($index)")
                                            i.remove.icon.margin-auto
                                        .ui.bottom.attached.button(ng-click="onSelectShowCase($index)")
                                            i.bookmark.icon.margin-auto

                            // button.ui.button.primary(ng-click="uploadFiles(newAdForm.files)")
                                | Upload

                            .progress(ng-show='progress >= 0')
                                    div(style='width:{{progress}}%', ng-bind="progress + '%'")
                                |     {{errorMsg}}

                        .field.ui.segment
                            .ui.grid
                                .sixteen.wide.column
                                    .ui.checked.checkbox
                                        input.hidden(type='checkbox', checked="", tabindex='0', name='anotherContactChecked', ng-model='newAdForm.anotherContact.checked')
                                        label Use another person tel number and name
                                .sixteen.wide.column.no-padding-top#anotherContact(ng-if="newAdForm.anotherContact.checked",  ng-cloak)
                                    .fields.two
                                        .field.wide.eight
                                            input(name='anotherContactName', placeholder='Contact Name', ng-model='newAdForm.anotherContact.name')
                                        .field.wide.eight
                                            input(name='anotherContactPhone', placeholder='Contact Phone Number', ng-model='newAdForm.anotherContact.phone')


                        .ui.error.message
                        .backendErr.ui.red.message(ng-if="newAdErr", ng-cloak)
                            | {{ newAdErr }}

                        if !user
                            a.ui.right.floated.primary.button(form="newAdForm", ng-click="uploadAndSaveRedis()", ng-class="newAdBtnLoading ? 'loading' : '' ")
                                | Next
                        else
                            a.ui.right.floated.primary.button(ng-click="previewTab()")
                                | Next

                        .clearfix

            div#preview(ng-if="steps.preview", ng-cloak)
                h2 {{ newAdForm.title }}
                h4 {{ newAdForm.price | currency }}

                .ui.four.cards
                    .card(ng-repeat='f in newAdForm.files')
                        .image
                            a.ui.left.corner.label(ng-if="f.showcase", ng-cloak)
                                i.bookmark.icon
                            img(
                                ngf-thumbnail="f.filename ? 'uploads/#{redisId}/{{f.filename}}': f ",
                                ngf-size="{width:200, height:200, quality:0.6}",
                                ng-src="img/spinner.gif",
                                class="upload-photo-thumb"
                            )

                br
                span.progress(ng-show='progress >= 0')
                    div(style='width:{{progress}}%', ng-bind="progress + '%'")
                |     {{errorMsg}}
                br
                br

                button.ui.right.floated.primary.button(ng-click="uploadAndSaveMongo('#{ redisId }')", ng-class="{loading:submitBtnLoading, disabled:uploading}")
                    | Save
                button.ui.right.floated.secondary.button(ng-click="adInformationTab()", ng-class="{disabled:uploading}")
                    | Back

        div(ng-if="adSaveComplete", ng-cloak)
            div.text-center
                h1 Everything is ok!
                div.margin-bottom-30 Your ad will be published after it is approved
                a.ui.primary.button(href="./") Home


append javascripts
    script(src="/dist/js/app/services/categoriesFactory.min.js")
    script(src="/dist/js/app/services/countriesFactory.min.js")
    script(src="/dist/js/app/directives/countryAndCategoryDropdowns.min.js")
    script(src="/dist/js/app/controllers/newAdController.min.js")
    script(src="semantic/dist/components/checkbox.min.js")
