extends layout

append stylesheets
    link(rel='stylesheet', type='text/css', href='semantic/dist/components/card.min.css')
    link(rel='stylesheet', type='text/css', href='semantic/dist/components/input.min.css')
    link(rel='stylesheet', type='text/css', href='semantic/dist/components/checkbox.min.css')
    link(rel='stylesheet', type='text/css', href='semantic/dist/components/card.min.css')
    link(rel='stylesheet', type='text/css', href='semantic/dist/components/step.min.css')
    link(rel='stylesheet', type='text/css', href='semantic/dist/components/loader.min.css')
    link(rel='stylesheet', type='text/css', href='/ngWig/dist/css/ng-wig.min.css')


block content
    div(ng-controller="newAdController")
        div(ng-if="!adSaveComplete", ng-cloak)

            .ui.steps.fluid(class="margin-bottom-30")
                a.step(ng-class="steps.informations ? 'active': 'disabled' " ng-cloak)
                    i.info.icon
                    .content
                        .title Ad Information
                        .description Please enter your ad informations.

                a.step(ng-class="steps.power ? 'active': 'disabled' " ng-cloak)
                    i.rocket.icon
                    .content
                        .title Buy Power
                        .description Your ad is in the top row.

                a.step.disabled(ng-class="steps.preview ? 'active':'disabled' " ng-cloak)
                    i.unhide.icon
                    .content
                        .title Preview
                        .description Your ad will look like this.

            .ui.segment.no-segment.test
                .ui.dimmer(ng-class="loadingBufferData ? 'active': ''")
                    .ui.text.loader Loading

                div#adInformation(ng-show="steps.informations", ng-cloak)
                    form.ui.form.fluid#newAdForm(ng-init="init('#{ redisId }','#{userExists}')")
                        input(type='hidden', name='Content-Type', value='')
                        input(type='hidden', name='Content-Type', ng-init="url= '#{ formdata.url }' ", ng-model="url")
                        input(type='hidden', name='acl', ng-model="acl", ng-init="acl= '#{ formdata.inputs.acl }'")
                        input(type='hidden', name='success_action_status', ng-model="success_action_status", ng-init="success_action_status= '#{ formdata.inputs.success_action_status }'" )
                        input(type='hidden', name='policy', ng-model="policy", ng-init="policy = '#{ formdata.inputs.policy }'")
                        input(type='hidden', name='X-amz-credential', ng-model="x_amz_credential", ng-init="x_amz_credential= '#{ formdata.inputs['X-amz-credential'] }'")
                        input(type='hidden', name='X-amz-algorithm', ng-model="X_amz_algorithm", ng-init="X_amz_algorithm = '#{ formdata.inputs['X-amz-algorithm'] }'")
                        input(type='hidden', name='X-amz-date', ng-model="X_amz_date", ng-init="X_amz_date = '#{ formdata.inputs['X-amz-date'] }'")
                        input(type='hidden', name='X-amz-expires', ng-model="X_amz_expires", ng-init="X_amz_expires = '#{ formdata.inputs['X-amz-expires'] }'")
                        input(type='hidden', name='X-amz-signature', ng-model="X_amz_signature", ng-init="X_amz_signature = '#{ formdata.inputs['X-amz-signature'] }'")

                        .fields.two
                            .field.wide.twelve
                                label Title
                                input(name='title', placeholder='Title',  ng-model="newAdForm.title")
                            .field.wide.four
                                label Price
                                .ui.right.labeled.input
                                    input(type='text', name="price", placeholder='Price', ng-model="newAdForm.price")
                                    .ui.basic.label
                                        | USD
                        .field
                            label Description
                            ng-wig(
                                name='description',
                                ng-model='newAdForm.description'
                            )
                        .five.fields(country-and-category-dropdowns)

                        .ui.tiny.stacked.segment
                            .text-center
                                .ui.labeled.button(tabindex='0', ng-click='triggerUploadWindow()')
                                    .ui.button
                                        i.upload.icon
                                        |  Upload Photos
                                    a.ui.basic.label
                                        | {{ newAdForm.files.length > 0 ? newAdForm.files.length : '0'  }}
                                input(
                                    type='file',
                                    style="width:30%"
                                    ngf-select='onPhotoSelect()',
                                    ng-model='newAdForm.files',
                                    name='photos',
                                    class='hidden'
                                    ngf-pattern="'image/*'",
                                    ngf-accept="'image/*'",
                                    ngf-max-size='2MB',
                                    ngf-multiple='true',
                                    ngf-keep='true',
                                    ngf-keep-distinct='true',
                                    ngf-max-files="10"
                                )

                            .clearfix &nbsp;

                            .ui.four.stackable.cards
                                .card(ng-repeat='f in newAdForm.files')
                                    .image
                                        a.ui.left.corner.label(ng-if="f.showcase", ng-cloak)
                                            i.bookmark.icon
                                        img(
                                            ngf-thumbnail="f.filename ? '#{ amazon_base_url }/{{f.filename}}': f ",
                                            ngf-size="{width:200, height:200, quality:0.6}",
                                            ng-src="img/spinner.gif",
                                            class="upload-photo-thumb"
                                        )

                                        span.progress(ng-hide="f.progressFinish", ng-if="f.progress >= 0")
                                            div(style='width:{{f.progress}}%', ng-bind="f.progress + '%'")


                                    .ui.bottom.attached.button(
                                        ng-click="onDeletePhoto($index)",
                                        ng-if="f.showcase",
                                        ng-cloak
                                    )
                                        i.remove.icon
                                        |  Remove


                                    .ui.two.buttons(ng-if="!f.showcase", ng-cloak)
                                        .ui.bottom.attached.button(ng-click="onDeletePhoto($index)")
                                            i.remove.icon.margin-auto
                                        .ui.bottom.attached.button(ng-click="onSelectShowCase($index)")
                                            i.bookmark.icon.margin-auto


                                | {{errorMsg}}

                        .field.ui.segment
                            .ui.grid
                                .sixteen.wide.column
                                    .ui.checked.checkbox
                                        input.hidden(type='checkbox', checked="", tabindex='0', name='anotherContactChecked', ng-model='newAdForm.anotherContact.checked')
                                        label Use another person tel number and name
                                .sixteen.wide.column.no-padding-top#anotherContact(ng-if="newAdForm.anotherContact.checked",  ng-cloak)
                                    .fields.two
                                        .field.wide.eight
                                            input(name='anotherContactName', placeholder='Contact Name', ng-model='newAdForm.anotherContact.name')
                                        .field.wide.eight
                                            input(name='anotherContactPhone', placeholder='Contact Phone Number', ng-model='newAdForm.anotherContact.phone')


                        .ui.error.message
                        .backendErr.ui.red.message(ng-if="newAdErr", ng-cloak)
                            | {{ newAdErr }}

                        button.ui.right.floated.primary.button(
                                form="newAdForm",
                                ng-class="uploading ? 'loading disabled' : '' "
                            )
                            | Next

                        .clearfix


                div#powerTab(ng-show="steps.power", ng-cloak)
                    div.text-center
                        h1 Power Up!
                        button.ui.primary.button#buttonCheckout Buy Power

                    button.ui.right.floated.primary.button(ng-click="previewTab()")
                        | Next
                    button.ui.right.floated.secondary.button(ng-click="adInformationTab()")
                        | Back



                div#preview(ng-show="steps.preview", ng-cloak)
                    h2 {{ newAdForm.title }}
                    h4 {{ newAdForm.price | currency }}

                    .ui.four.stackable.cards
                        .card(ng-repeat='f in newAdForm.files')
                            .image
                                a.ui.left.corner.label(ng-if="f.showcase", ng-cloak)
                                    i.bookmark.icon
                                img(
                                ngf-thumbnail="f.filename ? '#{ amazon_base_url }/{{f.filename}}': f ",
                                ngf-size="{width:200, height:200, quality:0.6}",
                                ng-src="img/spinner.gif",
                                class="upload-photo-thumb"
                                )

                                span.progress(ng-hide="f.progressFinish", ng-if="f.progress >= 0")
                                    div(style='width:{{f.progress}}%', ng-bind="f.progress + '%'")


                    br
                    span.progress(ng-show='progress >= 0')
                        div(style='width:{{progress}}%', ng-bind="progress + '%'")
                    |     {{errorMsg}}
                    br
                    br

                    button.ui.right.floated.primary.button(ng-click="uploadAndSaveMongo('#{ redisId }')", ng-class="{loading:submitBtnLoading, disabled:uploading}")
                        | Save
                    button.ui.right.floated.secondary.button(ng-click="powerTab()", ng-class="{disabled:uploading}")
                        | Back

        div(ng-if="adSaveComplete", ng-cloak)
            div.text-center
                h1 Everything is ok!
                div.margin-bottom-30 Your ad will be published after it is approved
                a.ui.primary.button(href="./") Home



append javascripts
    script(src="/dist/js/app/services/categoriesFactory.min.js")
    script(src="/dist/js/app/services/countriesFactory.min.js")
    script(src="/dist/js/app/directives/countryAndCategoryDropdowns.min.js")
    script(src="https://checkout.stripe.com/checkout.js")
    script(src="/js/app/controllers/newAdController.js")
    script(src="semantic/dist/components/checkbox.min.js")
