app.controller("detailController",["$scope","favFactory","rateFactory","messageFactory","detailFactory","eventFactory","reportFactory",(e,o,s,t,a,n,r)=>{function i(e,o,s,t){const a=document.createElement("div");a.style.backgroundColor="#fff",a.style.border="2px solid #fff",a.style.borderRadius="3px",a.style.boxShadow="0 2px 6px rgba(0,0,0,.3)",a.style.cursor="pointer",a.style.marginBottom="22px",a.style.textAlign="center",a.title="Click to recenter the map",e.appendChild(a);const n=document.createElement("div");n.style.color="rgb(25,25,25)",n.style.fontFamily="Roboto,Arial,sans-serif",n.style.fontSize="16px",n.style.lineHeight="38px",n.style.paddingLeft="5px",n.style.paddingRight="5px",n.innerHTML="Route",a.appendChild(n),a.addEventListener("click",()=>{const e=s+","+t;window.open("http://maps.google.com/maps?q=loc:"+e,"_blank")})}function d(e,o){new google.maps.Geocoder;const s=new google.maps.LatLng(e,o),t={zoom:13,center:s},a=new google.maps.Map(document.getElementById("googleMap"),t),n=(new google.maps.Marker({position:s,map:a,title:"Drag me!"}),document.createElement("div"));new i(n,a,e,o);n.index=1,a.controls[google.maps.ControlPosition.TOP_CENTER].push(n)}$(()=>{$("#sendMessageModal").modal({onHide:function(){e.messageSended=!1,e.sendMessageFormData.message="",$("body").removeClass("ios11-input-bug-fixer")},onShow:()=>{$("body").addClass("ios11-input-bug-fixer")}}),$("#reportModal").modal({onHide:function(){e.reportMessageSended=!1,e.reportFormData.message="",$("body").removeClass("ios11-input-bug-fixer")},onShow:()=>{$("body").addClass("ios11-input-bug-fixer")}}),$(".owl-carousel").owlCarousel({margin:10,items:5,dots:!0,nav:!0,smartSpeed:100}),$(".detail-right-menu a").popup({position:"bottom center"}),e.onRate=!1,$("#detailRating").rating({maxRating:5,onRate:o=>{if(!e.userId||"null"===e.userId)return alert("Please login"),!1;s.setRate(e.adId,o).then(e=>{console.log(e)}),e.onRate=!0}}),$("#sendMessageForm").form({keyboardShortcuts:!1,on:"blur",fields:{pw:{identifier:"message",rules:[{type:"empty",prompt:"Please enter your message."},{type:"maxLength[600]",prompt:"Your message can be up to {ruleValue} characters long."}]}},onSuccess:()=>{e.sendMessage()},onInvalid:()=>{e.sendMessageErr=null}}),$("#reportForm").form({keyboardShortcuts:!1,on:"blur",fields:{pw:{identifier:"message",rules:[{type:"empty",prompt:"Please enter your message."},{type:"maxLength[600]",prompt:"Your message can be up to {ruleValue} characters long."}]}},onSuccess:()=>{e.sendReport()},onInvalid:()=>{e.sendMessageErr=null}})}),e.init=((s,t,r,i,l,g)=>{e.adId=t,e.userId=s,d(l,g),"null"!==s&&o.isFav(s,t).then(o=>{e.isFav=o.isFav});try{let o=JSON.parse(r);o.forEach((e,o)=>{e.url=i+"/"+e.filename,e.id=o}),e.imagesa=o}catch(e){}a.getSimilars(e.adId).then(o=>{e.similarAds=o,console.log(o)}),n.getEventsByAdId(e.adId).then(o=>{e.events=o})}),e.addFavourites=((s,t)=>{o.addFavourites(s,t).then(o=>{o.status&&(e.isFav=!0)})}),e.delFavourites=((s,t)=>{o.delFavourites(s,t).then(o=>{o.status&&(e.isFav=!1)})}),e.deleteLoading=!1,e.deleteAd=(o=>{e.deleteLoading=!0,a.deleteAd(o).then(o=>{o.status&&(e.deleteLoading=!1,document.location.href="/")})}),e.showLang1=!0,e.changeDescriptionLanguage=(()=>{e.showLang1?(e.showLang1=!1,e.showLang2=!0):(e.showLang1=!0,e.showLang2=!1)}),e.openSendMessageModal=(()=>{$("#sendMessageModal").modal("show")}),e.openReportModal=(()=>{$("#reportModal").modal("show")}),e.sendMessage=(()=>{e.sendMessageLoading=!0,t.createConversation(e.sendMessageFormData).then(o=>{if(1!==o.status)return e.sendMessageLoading=!1,e.sendMessageErr=o.error,!1;t.createMessage(e.sendMessageFormData,o.conversationId).then(o=>{if(e.sendMessageLoading=!1,1!==o.status)return e.sendMessageErr=o.error,!1;e.messageSended=!0})})}),e.sendReport=(()=>{r.sendReport(e.reportFormData).then(o=>{console.log(o),o.status&&(e.reportMessageSended=!0)})}),e.methods={},e.openGallery=function(){e.methods.open()},e.changePhoto=(o=>{e.showcase=e.photos[o].filename}),e.showcase=((o,s)=>{e.photos=o,e.showcaseIndex=s,e.showcase=o[e.showcaseIndex].filename}),e.workTimesVisible=!1,e.toggleWorkTimes=(()=>{e.workTimesVisible?e.workTimesVisible=!1:e.workTimesVisible=!0})}]),app.config(["ngImageGalleryOptsProvider",function(e){e.setOpts({thumbnails:!0,thumbSize:40,inline:!1,bubbles:!0,bubbleSize:20,imgBubbles:!1,bgClose:!0,piracy:!1,imgAnim:"fadeup"})}]);