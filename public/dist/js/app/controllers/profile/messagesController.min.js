app.controller("messagesController",["$scope","messageFactory","$routeParams",function(e,s,a){function o(){setTimeout(()=>{n.scrollTop=n.scrollHeight},1)}let n=document.getElementById("messageList");e.sendMessageFormData={},e.loadingMessages=!1,e.loadingConversations=!0,s.getConversations().then(s=>{if(e.loadingConversations=!1,e.conversations=s,a.id){let s=e.conversations.find(e=>String(e._id)===String(a.id)).ad;console.log(s),e.ad.title=s.title,e.ad.price=s.price,e.ad.slug=s.slug,e.ad.id=s._id,e.ad.showcasePhoto=s.photos[s.photoShowcaseIndex].filename}}),e.ad={},a.id&&(e.sendMessageFormData.conversationId=a.id,e.visibleMessages=!0,e.loadingMessages=!0,s.getMessages(a.id).then(n=>{e.loadingMessages=!1,e.messages=n.data,e.sendMessageFormData.toUserId=n.toUserId,o(),s.markAsRead(a.id,e.sendMessageFormData.toUserId).then(e=>{console.log(e)})})),e.messageSended=!1,e.sendMessage=(()=>{e.sendMessageLoading=!0,s.createMessage(e.sendMessageFormData,e.sendMessageFormData.conversationId).then(s=>{if(e.sendMessageLoading=!1,1!==s.status)return e.sendMessageErr=s.error,!1;e.messages.push({message:e.sendMessageFormData.message,createdAt:new Date,user:{name:e.sendMessageFormData.username,surname:e.sendMessageFormData.surname}}),e.sendMessageFormData.message="",o()})})}]);