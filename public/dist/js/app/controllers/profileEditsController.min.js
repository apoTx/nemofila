app.controller("profileEditsController",["$scope","Upload","$timeout","$http","$window","newAdFactory","countriesFactory","categoriesFactory","config","Slug",(e,t,o,a,n,r,d,i,l,s)=>{function m(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}e.newAdForm={},e.newAdForm.anotherContact={},e.steps={},e.steps.informations=!0,e.steps.power=!1,e.steps.preview=!1,e.powerNumber="0",e.buyPowerStatus=!1,e.buyPowerLoader=!1,e.newAdForm.place=null,e.autocompleteOptions={types:["(cities)"]},e.next=(()=>{e.previewTab(),e.$apply()}),e.back=(()=>{e.adInformationTab()}),e.uploadedFiles=[],e.getAd=((t,o)=>{e.loadingBufferData=!0,a({url:"/newAd/getEditAd/"+t,method:"GET"}).then(t=>{e.newAdForm.title=t.data.title||"",e.newAdForm.description=t.data.description||"",e.newAdForm.description2=t.data.description2||"",e.newAdForm.phone=t.data.phone||"",e.newAdForm.mobile_phone=t.data.mobile_phone||"",e.newAdForm.address=t.data.address||"",e.newAdForm.website=t.data.website||"",e.newAdForm.anotherContact=t.data.anotherContact,e.newAdForm.place=t.data.place,e.newAdForm.workTimes=t.data.workTimes,e.newAdForm.anotherContact||(e.newAdForm.anotherContact={},e.newAdForm.anotherContact.checked=!1);try{e.newAdForm.files=t.data.photos||"",e.uploadedFiles=e.newAdForm.files,e.newAdForm.showcaseIndex=t.data.photoShowcaseIndex}catch(t){e.newAdForm.files=[]}let a=t.data.category;setTimeout(()=>{e.newAdForm.category=e.categories.findIndex(e=>String(e._id)===String(a.categoryId)).toString(),e.newAdForm.categoryChild=e.categories[e.newAdForm.category].subCategories.findIndex(e=>String(e._id)===String(a.categoryChildId)).toString()}),e.loadingBufferData=!1,o()},()=>{console.log("fail"),e.loadingBufferData=!1})}),e.uploadAndSaveMongo=(t=>{e.newAdForm.files&&e.newAdForm.files.length>0?e.uploadFiles(e.newAdForm.files,t):e.onSubmitAd(null,t,!1)}),e.uploading=!1,e.uploadFiles=((o,a)=>{e.uploading=!0,o&&o.length&&o.forEach(o=>{let a=o.name.split("."),n=a[a.length-1],r=m()+"."+n;o.upload=t.upload({url:l.s3_upload_url,method:"POST",data:{key:r,acl:e.acl,policy:e.policy,"X-amz-signature":e.X_amz_signature,"X-amz-credential":e.x_amz_credential,"X-amz-algorithm":e.X_amz_algorithm,"X-amz-date":e.X_amz_date,"Content-Type":""!=o.type?o.type:"application/octet-stream",filename:r,file:o}}),o.upload.then(t=>{e.result=t.data,e.uploading=!1},t=>{t.status>0&&(e.errorMsg=t.status+": "+t.data)},e=>{o.progress=Math.min(100,parseInt(100*e.loaded/e.total))})})}),e.newAdForm.showcaseIndex=0,e.onPhotoSelect=(()=>{e.isEdit?e.uploadedFiles<1&&(e.newAdForm.files[0].showcase=!0):e.newAdForm.files.length>0&&(e.newAdForm.files[e.newAdForm.showcaseIndex].showcase=!0)}),e.triggerUploadWindow=(()=>{$('input[type="file"]').trigger("click")})}]);